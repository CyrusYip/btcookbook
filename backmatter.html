<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>后记1 | TNT 擂台赛</title>
  <meta name="description" content="后记1 | TNT 擂台赛" />
  <meta name="generator" content="bookdown 0.12.2 and GitBook 2.6.7" />

  <meta property="og:title" content="后记1 | TNT 擂台赛" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="pzhaonet/book-bt" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="后记1 | TNT 擂台赛" />
  
  
  

<meta name="author" content="大鹏（编）" />


<meta name="date" content="2019-08-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="section-5.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">TNT 擂台赛</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>序言</a></li>
<li class="chapter" data-level="1" data-path="section-1.html"><a href="section-1.html"><i class="fa fa-check"></i><b>1</b> 曲线簇</a></li>
<li class="chapter" data-level="2" data-path="section-2.html"><a href="section-2.html"><i class="fa fa-check"></i><b>2</b> 直方图的对数坐标</a></li>
<li class="chapter" data-level="3" data-path="section-3.html"><a href="section-3.html"><i class="fa fa-check"></i><b>3</b> 绘制地图</a></li>
<li class="chapter" data-level="4" data-path="section-4.html"><a href="section-4.html"><i class="fa fa-check"></i><b>4</b> 从字符串里提取年和月</a></li>
<li class="chapter" data-level="5" data-path="section-5.html"><a href="section-5.html"><i class="fa fa-check"></i><b>5</b> 数据框筛选重写</a></li>
<li class="chapter" data-level="" data-path="backmatter.html"><a href="backmatter.html"><i class="fa fa-check"></i>后记</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">TNT 擂台赛</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="backmatter" class="section level1 unnumbered">
<h1>后记<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></h1>
<p><strong><em>1</em></strong></p>
<p>R 语言的”极乐净土“ tidyverse 包，对我而言是个奇葩的存在。就像它的颜值担当成员”哥哥画图呃“ <a href="https://openr.netlify.com/zh/blog/ggplot2-problems/">ggplot2</a> 一样，这个东西我学起来用起来特别吃力。</p>
<p>网上到处都是对 tidyverse 一片喝彩，几乎听不到任何负面的声音，这个现象我觉得很奇怪。比如搜一下“tidyverse 缺点 不足 问题”，是搜不到结果的。这让我有点警惕。不过，这是个数据科学领域的工具，我是外行，而且年岁大了，可能是我自己的问题吧。R 基础包已经够我了此残生了，tidyverse 学不会就算了吧。</p>
<p>然而见得多了，发现不学不行了。比如有人在 Stack Overflow 提了个<a href="https://stackoverflow.com/questions/56072427/how-to-get-month-and-week-of-the-month-from-year-and-week-no-in-r/56074801#56074801">问题</a>，得到的是 tidyverse 版的回答，不懂 %&gt;% 是啥的话还真看不懂，虽然明明是基础函数就能解决。</p>
<p>原来，国王连锄地都用金锄头啊！</p>
<p>我隐隐担忧起来。万一世界被 tidyverse 一统江湖，我遇见基础包的问题可咋办，问都没处问去，人家解答了我也看不懂……</p>
<p>不止我一个人有这种困惑。</p>
<p>比如，一个朋友就私下向我抱怨：</p>
<blockquote>
<p>如果在论坛提问如何用 R 做个什么图，那么回帖最多的肯定是用 ggplot。然而 ggplot 各种诡异和思想颠覆，太难记，要是一点不懂 R 的基础绘图还好点。有的图，基础包两三句就行， ggplot 要隆重地写上很大一段，满满的仪式感。</p>
</blockquote>
<p>的确如此。</p>
<p>举两个例子。</p>
<p>比如，我想为 <code>diamonds</code> 这个数据框的钻石品质数据做个柱状图，看看各种品质的钻石有多少个。</p>
<p>用基础命令，思路很正常也单纯：先用 <code>table()</code> 算出 <code>cut</code> 列每种品质的钻石有多少个，再用 <code>barplot()</code> 把数据用图表达出来：</p>
<pre><code>barplot(table(diamonds$cut))</code></pre>
<p>而 tidyverse，需要先加载包，然后把数据映射过去，最后添加个 x 轴的美学映射——这几个术语我吃不准用得对不对，反正代码就是这样复杂：</p>
<pre><code>require(&#39;tidyverse&#39;)
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut))</code></pre>
<p>再比如说，我想计算一下各种品质钻石的平均价格。</p>
<p>用基础命令，思路很正常也很单纯：一条 <code>tapply()</code> 函数搞定，只需指定一下“算谁，按谁算，咋算”就行了：</p>
<pre><code>tapply(diamonds$price,      # 算 价格
       diamonds$cut,        # 按 cut 分类算
       mean, na.rm = TRUE)  # 求平均

##      Fair      Good Very Good   Premium     Ideal 
##  4358.758  3928.864  3981.760  4584.258  3457.542</code></pre>
<p>而 tidyverse，加载包那一步就不提了，需要先用 <code>group_by()</code>按 <code>cut</code>列来分一下组，再用 <code>summarize()</code>来做总结，里面指定一下总结方式是<code>mean()</code>，光是说起来都累：</p>
<pre><code>diamonds %&gt;% 
  group_by(cut) %&gt;% 
  summarise(mean(price, na.rm = TRUE))

## # A tibble: 5 x 2
##   cut       `mean(price, na.rm = TRUE)`
##   &lt;ord&gt;                           &lt;dbl&gt;
## 1 Fair                            4359.
## 2 Good                            3929.
## 3 Very Good                       3982.
## 4 Premium                         4584.
## 5 Ideal                           3458.</code></pre>
<p>R 基础包多好啊，为什么那么多初学者会<a href="https://d.cosx.org/d/420667/3">纠结</a>是学 R 基础命令，还是学 tidyverse？</p>
<p>当时尚有周天子，何事纷纷说魏齐？</p>
<p><strong><em>2</em></strong></p>
<p>这个问题困扰了我好久。</p>
<p>有一天，我决定好好思考一下这个问题。</p>
<p>了解 tidyverse 的最好办法，就是去读官方综合教程：<a href="https://r4ds.had.co.nz/">R for Data Science</a>。</p>
<p>原以为大神的书都艰深晦涩，没想到这本书写得非常通俗易懂，就是函数名字难记。我学会了好多动词，比如 mutate 这个词，我一直以为是 X 战警生造的，就像哈利波特里的麻瓜(Muggle)一样。我从来没在任何其他场合听说读写过它，这回算是长知识了。</p>
<p>读着读着，不知怎么，晴空里一道闪电，我突然开了窍，说服了自己：tidyverse 用法的奇葩之处，是有理由的。</p>
<p>tidyverse 的世界里，有一只指南针。有它在手，我此前关于 tidyverse 的困惑一扫而空。</p>
<p>这个指南针就是“管道”。</p>
<p>（可以阅读 yihui 的<a href="https://yihui.name/cn/2017/07/long-live-the-pipe/">管道时代</a>一文。）</p>
<p>管道的意思是，管道前面得到的输出，不落地，直接作为管道后面的输入。</p>
<p>打个比方。</p>
<p>不使用管道的时候，好比吃中餐，合餐制。从厨房输出的每道菜，先各自占用一个盘子，再端到大圆桌上，每个人把菜输入到自己碗里。</p>
<p>合餐的好处是你可以自由搭配，想从哪个盘子夹多少菜多少肉都行，到你的碗里就是独一无二的组合，还可以随便放调料。坏处是不仅占桌子占盘子，而且洗碗特别麻烦，因为除了洗每人的碗筷和锅，你还得洗每道菜的盘子这种中间步骤。</p>
<p>西餐就省事多了，分餐制，只需一步，直接将厨房输出的菜输入到每人的盘子里，省却了中间步骤。这就是管道的妙处。</p>
<p>以上是一个家里没有洗碗机而经常从事洗碗劳动的非程序员的日常心得。</p>
<p>正是为了能够全程使用管道，tidyverse 用了一根筋的办法：各个函数，输入的必须是数据框，输出的也必须是数据框。而且最好是超级数据框（ tibble）。</p>
<p>这就好比吃西餐，从锅里输出的必须是比较干的菜，例如香肠土豆什么的，这样才能用刀叉（管道）把他们直接输入到用户的盘子里。如果输出的是汤，对不起，你得把里面的水先煮干，再把其中的干货用刀叉（管道）输出到用户的盘子里。当然，后续可以由用户往里加水复原成汤——奇葩吧？对，这就是为啥 tidyverse 搞出那么多奇葩函数的根本原因。都是为了适应管道的需求。管道两头都必须是类型相同的干货：数据框。</p>
<p>上文举的两个例子，R 基础包用的 <code>table()</code> 和 <code>tapply()</code>，一个要求输入的是一个向量，输出的是一个表格，另一个要求输入的两个向量，输出的是一个数组。输入和输出这两头自己都不一致，跟别的函数更不一致，没法统一用管道。</p>
<p>表面上，R 基础包更省事，然而 zoom out 一下，从总体上看，放到前后相继的一串代码里，却是管道更省事。这算是舍小弊而取大利，为了宏观而牺牲微观吧。</p>
<p>管道符号 <code>%&gt;%</code> 已经普及到了 tidyverse 的大片领地，偏偏是带头大哥的 ggplot2 没有使用，而用了加号。这是因为 <code>%&gt;%</code> 诞生较晚，是个后生。然而后生长过先生，ggplot2 的下一代版本”格格巫师“（ggvis）全面使用<code>%&gt;%</code> 代替加号了，颇有秦朝车同轨书同文的意味。</p>
<p>有了管道，数据处理从最初到最终成品一气呵成，畅快淋漓。可以设想，习惯之后再学 R 基础函数得需要多大勇气和耐心。</p>
<p><strong><em>3</em></strong></p>
<p>我接触 R 比较晚。2010 年整整一年，我都在用 Visual Basic 吭哧吭哧跟数据死磕，2011 年才开始真正接触 R（此前只是听说过），不知道此前发生过什么，只知道有 R 基础命令这种周天子，没听说过 ggplot2。</p>
<p>R 基础命令作图能满足我的绝大部分需求。不过，当时我已经知道 lattice 包的存在，震惊的程度不亚于后来遇见 ggplot2。lattice 让我联想到齐桓公，虽然称雄与 R 语言绘图界，但并没有像今天的 ggplot2 给人”你到底是用我还是用 R 基础包？“的选择压力——至少我没有。不用 lattice？没关系，能出结果就行。用 lattice？好啊，画图更方便。齐桓公尊王攘夷，得到了周天子的认可，lattice 包也被 R 基础包认可，常年作为 R 的默认安装包。不知道 lattice 是怎么做到的。</p>
<p>后来，ggplot2 崛起，作为新一代的霸主，在江湖地位上，显然取代了齐桓公 lattice。我不止在一处看到有人建议，R 安装包里应该用 ggplot2 取代 lattice，从周天子层面确认 ggplot2 的霸主地位。只是不知道周天子在犹豫什么。</p>
<p>后来的后来，ggplot2 的周边生态完善，联合了一大群彼此兼容的包，成立了联盟，这便是虎狼之邦的 tidyverse。</p>
<p>如果你是个新居民，刚刚搬家踏上 R 语言的土地，可能会遇到一个奇怪的问题：</p>
<p>你是想住进极乐净土的秦国 tidyverse，还是住进纷繁扰攘的周朝 R base？</p>
<p>新居民可能摸不着头脑：这是什么逻辑？秦国不是就在周朝里吗？</p>
<p>别人可能神秘一笑：生活在秦国的人，不需要知道周天子。</p>

</div>






<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>原载 openr.org，原标题为“当时尚有 R base，何事纷纷说 e”<a href="backmatter.html#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-5.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
